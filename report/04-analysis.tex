\chapter{Анализ предметной области}

\begin{comment}
С ростом числа запросов к системе, встает вопрос о ее масштабировании.
Масштабирование — это процесс роста системы со временем, для эффективной
обработки все большего и большего количества запросов в единицу времени \cite{mashtab}.
Выделяют два вида масштабирования: горизонтальное и вертикальное \cite{uzel,mashtabtypes1,mashtabtypes2}. Вертикальное масштабирование происходит за счет увеличения мощности
вычислительного узла. Однако, использования только такого подхода часто
не хватает, поскольку постоянно увеличивая мощность, однажды будет до-
стигнут «потолок» производительности и дальнейшие аппаратные улучшения
будут недоступны. В таком случае для дальнейшего роста производительности
применяют горизонтальное масштабирование, которое заключается в добавле-
нии новых вычислительных узлов, выполняющих одинаковые функции. Для
расширения возможностей горизонтального масштабирования используются
балансировщики нагрузки \cite{mashtabtypes1,mashtabtypes2}.
\end{comment}

Балансировка нагрузки --- это механизм приблизительного выравнивания рабочей нагрузки между всеми узлами распределенной системы \cite{anal}.
Это позволяет ускорить обслуживание заданий, например, свести к минимуму время отклика и повысить эффективность использования ресурсов.
\begin{comment}
	
Некоторые из основных целей алгоритма балансировки нагрузки, как указано в, заключаются в следующем: добиться большего общего улучшения производительности системы при разумных затратах, например, сократить время отклика задачи при сохранении приемлемых задержек; одинаково относиться ко всем заданиям в системе независимо от их происхождения; обладать отказоустойчивостью:
выносливостью производительности при частичном сбое в системе; иметь возможность модифицировать себя в соответствии с любыми изменениями или расширяться в конфигурации распределенной системы; и поддерживать стабильность системы: способность учитывать чрезвычайные ситуации, такие как внезапный всплеск поступлений, чтобы производительность системы не ухудшалась сверх определенного порога, одновременно предотвращая, чтобы узлы распределенной системы тратили слишком много времени на передачу заданий между собой вместо выполнения эти рабочие места. \cite{4}	

Cледует еще четко понимать, о чем идет речь: о распределении или балансировке нагрузки. Несмотря на свою схожесть, эти понятия нельзя назвать взаимозаменяемыми. Так, распределение нагрузки предполагает ее равномерное разделение между серверами. А вот балансировка – это уже ее частный случай, учитывающий ряд факторов, подверженных изменению. \cite{4}
\end{comment}
\section{Алгоритмы решения задачи балансировки}
Балансировщик нагрузки работает по одному из алгоритмов, решающих задачу балансировки.
На вход этому алгоритму подается некоторое число запросов, приходящих в систему и набор вычислительных узлов, которыми
располагает система.
Задача алгоритма сводится к минимизации времени обработки запросов, за счет распределения запросов по вычислительным
узлам.

Для анализа алгоритмов балансировки могут быть выделены следующие параметры \cite{uzel}:

\begin{enumerate}[label=---]
	\item точность прогнозирования --- степень соответствия расчетных результатов работы алгоритма их фактическому значению;
	\item стабильность --- уровень задержек в передаче информации между всеми участниками балансировки;
	\item отказоустойчивость --- показывает устойчивость алгоритма к возникновению разнообразных ошибок;
	\item потребность в ресурсах --- количество ресурсов, затрачиваемых на процесс балансировки нагрузки;
	\item время обработки нового запроса --- время от поступления нового запроса до его перенаправления к цели.
\end{enumerate}

Алгоритмы балансировки разделяют на статические и динамические \cite{uzel}.

\section{Статическая балансировка}
Статическая балансировка --- это метод распределения нагрузки на узлы, основанный на заранее определенных параметрах.
\begin{comment}
Основная цель статической балансировки состоит в том, чтобы равномерно распределить трафик между несколькими узлами, чтобы каждый узел получал приблизительно одинаковое количество нагрузки.
\end{comment}

При использовании статической балансировки узлы настраиваются по разному \cite{mainsource}:
\begin{enumerate}[label=---]
	\item По равномерному распределению нагрузки --- каждый узел получает аналогичное количество запросов.
	\item По приоритету --- выделенные узлы имеют больший приоритет и получают больше запросов.
	\item По типу запроса --- различные типы запросов могут быть отправлены на разные узлы для оптимизации обработки.
\end{enumerate}

\begin{comment}

Процесс работы статической балансировки выглядит следующим образом:
\begin{enumerate}[label=---]
	\item Балансировщик нагрузки получает запрос от клиента.
	\item Балансировщик принимает решение о том, на какой сервер направить запрос, основываясь на предварительных настройках.
	\item Балансировщик перенаправляет запрос на выбранный сервер.
	\item Сервер обрабатывает запрос и отправляет ответ клиенту через балансировщик.
\end{enumerate}
\end{comment}


\section{Динамическая балансировка}

Динамические алгоритмы осуществляют мониторинг состояния каждого из узлов и выбирают «наилучший», в рассматриваемый момент времени, из них \cite{webmanage}. К динамическим алгоритмам относятся:
\begin{itemize}
	\item Least Connections
	\item Weighted Least Connections
	\item Least Time
\end{itemize}

\subsection{Least Connections}

Алгоритм Least Connections распределяет нагрузку между узлами, в зависимости от количества активных соединений, обслуживаемых каждым узлом.
Узел с наименьшим числом соединений будет обрабатывать следующий запрос, а узлы с большим числом соединений будет перераспределять свою нагрузку на узлы с меньшей загрузкой \cite{leastconnection}.


Пусть имеется имеется $N$ запросов и $M$ узлов. Пусть для каждого узла есть количество активных соединений $conns$.
Алгоритм состоит из следующих шагов:

\begin{enumerate}
	\item сформировать массив, содержащий узлы;
	\item установить указатель $target$ на первый узел;
	\item пройтись циклом по всем узлам массива, кроме первого:
	
	--- если $conns$ текущего узла меньше $conns$ узла $target$, то установить $target$ на текущий узел; 
	
	\item отправить запрос на узел $target$.
\end{enumerate}


Особенности алгоритма Least Connections:
\begin{enumerate}[label=---]
	\item низкая степень прогнозирования; 
	\item низкая стабильность;
	\item высокая отказоустойчивость, поскольку постоянно собирается информация об узлах, и, в случае отказа, система перераспределит ресурсы;
	\item высокая потребность в ресурсах, поскольку необходимо постоянно собирать информацию о узлах в реальном времени;
	\item высокое время обработки нового запроса, поскольку балансировщику нагрузки необходимо время, чтобы правильно перенаправить задачу.
\end{enumerate}


\begin{comment}
Балансировка нагрузки по наименьшему количеству подключений --- это алгоритм динамической балансировки нагрузки, при котором запросы распределяются узлы с наименьшим количеством активных подключений на момент получения запроса \cite{leastconns}.

\end{comment}


\subsection{Weighted Least Connections}

https://oaji.net/articles/2019/2698-1569231711.pdf

Данный алгоритм комбинирует принципы алгоритмов Least Connections и Weighted Round Robin \cite{weightedroundrobin}. %\cite{mainsource}. 
Он учитывает как веса узлов, так и количество активных соединений. 
% Серверы с более высоким значением веса будут получать больший процент активных подключений в любой момент времени. 
%Вес сервера по умолчанию равен единице, и администратор IPVS или программа мониторинга могут назначить любой вес реальному серверу. 
Новое сетевое подключение предоставляется узлу, который имеет минимальное отношение количества текущих активных подключений к его весу \cite{mainsource}.

Пусть имеется имеется $N$ запросов и $M$ узлов. Пусть для каждого узла есть количество соединений $conns$ и вес $weight$.
Алгоритм состоит из следующих шагов:

\begin{enumerate}
	\item сформировать массив, содержащий узлы;
	\item установить указатель $target$ на первый узел;
	\item пройтись циклом по всем узлам массива, кроме первого:
	
	--- если отношение $conns$ и $weight$ текущего узла меньше отношения $conns$ и $weight$ узла $target$, то установить $target$ на текущий узел; 
	
	\item отправить запрос на узел $target$.
\end{enumerate}

https://cyberleninka.ru/article/n/sravnitelnyy-analiz-algoritmov-balansirovki-nagruzki-v-srede-oblachnyh-vychisleniy/viewer

Особенности алгоритма Weighted Least Connections:
\begin{enumerate}[label=---]
	\item динамический тип;
	\item низкая степень прогнозирования; 
	\item низкая стабильность;
	\item высокая отказоустойчивость;
	\item высокая потребность в ресурсах;
	\item высокое время обработки нового запроса;
	\item благодаря весам, возможно осуществить настройку алгоритма таким образом, чтобы он учитывал различия в технических характеристиках узлов.
	\item при учитывании сразу двух критериев (количества подключений и веса) выбор нового узла происходит более сбалансировано.
\end{enumerate}

%В алгоритме планирования наименьшего взвешенного соединения (WLC) каждому серверу могут быть присвоены различные весовые коэффициенты производительности. Взвешенный алгоритм планирования наименьшего количества подключений делает с алгоритмом наименьшего количества подключений то же, что взвешенный алгоритм циклического перебора делает с алгоритмом циклического перебора. То есть, он вводит "вес", который основан на спецификациях каждого сервера.

\subsection{Least Time}
